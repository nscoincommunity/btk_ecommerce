{{ header }}{{ column_left }}
<div id="content">
    <style>
        .list-group-item:hover { cursor: move; }
        .list-group-item { margin-top: 5px; }
    </style>
  <div class="page-header">
    <div class="container-fluid">
         <h1>{{ heading_title }}</h1>
      <ul class="breadcrumb">
        {% for breadcrumb in breadcrumbs %}
        <li><a href="{{ breadcrumb['href'] }}">{{ breadcrumb['text'] }}</a></li>
        {% endfor %}
      </ul>
    </div>
  </div>
  <div class="container-fluid">
    {% if error_warning %}
    <div class="alert alert-danger"><i class="fa fa-exclamation-circle"></i> {{ error_warning }}
      <button type="button" class="close" data-dismiss="alert">&times;</button>
    </div>
    {% endif %}
    {% if success %}
    <div class="alert alert-info"><i class="fa fa-check-circle"></i> {{ success }}
      <button type="button" class="close" data-dismiss="alert">&times;</button>
    </div>
    {% endif %}
    
    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title"><i class="fa fa-pencil"></i> {{ text_edit }}</h3>
          <div class="clearfix"></div>
      </div>
<form action="{{ action }}" method="post" enctype="multipart/form-data" id="form-setting" class="form-horizontal">

      <div class="panel-body">
          
            <button type="submit" form="form-setting" data-toggle="tooltip" title="{{ button_save_all_setting }}" class="btn btn-info pull-right"><i class="fa fa-save"></i> {{ button_save_all_setting }} </button> 

           <ul class="nav nav-tabs">
            <li class="active"><a href="#tab-general" data-toggle="tab"><i class="fa fa-home"></i> {{ tab_general }}</a></li>
            <li><a href="#tab-authentication" data-toggle="tab"><i class="fa fa-key"></i> {{ tab_authentication }}</a></li>
            <li><a href="#tab-shipping" data-toggle="tab"><i class="fa fa-truck"></i> {{ tab_shipping }}</a></li>
            <li><a href="#tab-sortorder" data-toggle="tab"><i class="fa fa-reorder"></i> {{ tab_sort_order }}</a></li>
            <li><a href="#tab-advance" data-toggle="tab"><i class="fa fa-gear"></i> {{ tab_advance }}</a></li>
            <li><a href="#tab-help" data-toggle="tab"><i class="fa fa-question-circle"></i> {{ tab_help }}</a></li>
          </ul>
       <div class="tab-content">
           <div class="clearfix"></div>
            <div class="tab-pane active" id="tab-general">   
    <fieldset>
        <legend>{{ text_handling_fee }}</legend>  
               <div class="form-group required">
        <label class="col-sm-3" for="module_bundle_handling_fee">
                    {{ entry_handling_fee }}
                    <h6>{{ help_handling_fee }}</h6>       
                  </label>
                <div class="col-sm-9">
                  <input type="text" name="module_bundle_handling_fee" value="{{ module_bundle_handling_fee }}" id="module_bundle_handling_fee" size="10" style="width: 120px;" class="form-control" />
                </div>
              </div> 
               <div class="form-group required">
                <label class="col-sm-3" for="module_bundle_handling_fee">
                    {{ entry_handling_fee_mode }}
                    <h6>
                    <p>{{ text_total_mode_help }} </p>
                    <p>{{ text_weight_mode_help }}</p>
                    </h6>
                   </label>
                <div class="col-sm-9">
                {% if module_bundle_handling_fee_mode == "flat" %}
                  <input checked="checked" type="radio" name="module_bundle_handling_fee_mode"  value="flat" id="module_bundle_handling_fee_mode" /> {{ text_total_mode }}
           <div style="clear: both; width: 100%; height: 1px;"></div>  
                 <input type="radio" name="module_bundle_handling_fee_mode"  value="perweight" id="module_bundle_handling_fee_mode" /> {{ text_weight_mode }}
                   {% else %}  
                     <input type="radio" name="module_bundle_handling_fee_mode"  value="flat" id="module_bundle_handling_fee_mode" /> {{ text_total_mode }}
           <div style="clear: both; width: 100%; height: 1px;"></div>  
                 <input checked="checked" type="radio" name="module_bundle_handling_fee_mode"  value="perweight" id="module_bundle_handling_fee_mode" /> {{ text_weight_mode }}
                     {% endif %}                           
                </div>
              </div>
                </fieldset>
                <fieldset>
                    <legend>{{ text_assurance }}</legend>     
         <div class="form-group required">
                <label class="col-sm-3" for="module_bundle_assurance">{{ entry_assurance }}</label>
                <div class="col-sm-9">
                    <input name="module_bundle_assurance" type="checkbox" data-control="checkbox" value="1" data-off-label="{{ text_no }}" data-on-label="{{ text_yes }}" {% if module_bundle_assurance %} checked="checked" {% endif %}>
                    </div>
              </div>
        <div class="form-group required">
                <label class="col-sm-3" for="module_bundle_total_assurance">
                     <p>{{ entry_total_assurance }}</p>
                    <h6>{{ help_total_assurance }}</h6>
             </label>
                <div class="col-sm-9">
                  <input type="text" name="module_bundle_total_assurance" value="{{ module_bundle_total_assurance }}" id="module_bundle_total_assurance" size="10" class="form-control" />
                </div>
              </div>
        
        <div class="form-group required">
                <label class="col-sm-3">
                    <p>{{ entry_assurance_percentage }}</p>
                    <h6>{{ help_assurance_percentage }}</h6>
            </label>
                <div class="col-sm-9">
                  <input type="text" name="module_bundle_assurance_percentage" value="{{ module_bundle_assurance_percentage }}" placeholder="{{ text_assurance_placeholder }}" id="module_bundle_assurance_percentage" size="10" class="form-control" />
                </div>
              </div>
        </fieldset> 
                <fieldset id="options">
                    <legend>{{ text_options }}</legend>    
<div class="form-group required">
                <label class="col-sm-3">
                    {{ entry_display_shipping_from }}
                    <h6> {{ help_display_shipping_from }} </h6>
                </label>
                <div class="col-sm-9">
                    <input name="module_bundle_shipping_from" type="checkbox" data-control="checkbox" value="1" data-off-label="{{ text_no }}" data-on-label="{{ text_yes }}" {% if module_bundle_shipping_from %} checked="checked" {% endif %}>
                    <img src="view/image/shipping/shipping_from.png" />
                    </div>
              </div> 
                    
                <div class="form-group required">
                <label class="col-sm-3">
                    {{ entry_shipping_available }}
                    <h6>{{ help_shipping_available }}</h6>
            </label>
                <div class="col-sm-9">
                  <div class="shipping-services">
                      <span><input name="module_bundle_shipping_available" type="checkbox" data-control="checkbox" value="1" data-off-label="{{ text_no }}" data-on-label="{{ text_yes }}"  {% if module_bundle_shipping_available %} checked="checked" {% endif %}> {{ name }}</span>
                      </div>
                </div>
              </div>           
                    
            <div class="form-group required">
                <label class="col-sm-3">
                    {{ entry_display_image_orderinfo }}
            </label>
                <div class="col-sm-9">
                      <span><input name="module_bundle_display_image_orderinfo" type="checkbox" data-control="checkbox" value="1" data-off-label="{{ text_no }}" data-on-label="{{ text_yes }}"  {% if module_bundle_display_image_orderinfo %} checked="checked" {% endif %}> {{ name }}</span>
                    <img src="view/image/shipping/image_orderinfo.png" />                                       
                </div>
              </div>
                    
                <div class="form-group required">
                <label class="col-sm-3">
                    {{ entry_display_image_ordertotal }}
                    <h6>{{ help_display_image_ordertotal }}</h6>
            </label>
                <div class="col-sm-9">
                      <span><input name="module_bundle_display_image_ordertotal" type="checkbox" data-control="checkbox" value="1" data-off-label="{{ text_no }}" data-on-label="{{ text_yes }}"  {% if module_bundle_display_image_ordertotal %} checked="checked" {% endif %}> {{ name }}</span>
                    <img src="view/image/shipping/image_ordertotal.png" />                   
                </div>
              </div>
                </fieldset>
    <fieldset>
        <legend>{{ text_shipping_basis }}</legend>
<div class="form-group required">
            <label class="col-sm-3" for="input-province">{{ entry_province }}</label>
            <div class="col-sm-9">
              <select name="module_bundle_province_id" id="input-province" class="form-control">
                  <option>{{ text_select }}</option>
                   {% for country in countries %}
                    {% if country.country_id == module_bundle_province_id %}
                <option value="{{ country.country_id }}" selected="selected">{{ country.name }}</option>
                    {% else %}
                <option value="{{ country.country_id }}">{{ country.name }}</option>
                  {% endif %}
                {% endfor %}
              </select>
            </div>
          </div>
          <div class="form-group required">
            <label class="col-sm-3" for="input-city">{{ entry_city }}</label>
            <div class="col-sm-9">
              <select name="module_bundle_city_id" id="input-city" class="form-control">
              </select>
            </div>
          </div>
        <div class="form-group required">
            <label class="col-sm-3" for="input-city">{{ entry_subdistrict }}</label>
            <div class="col-sm-9">
              <select name="module_bundle_sub_district_id" id="input-subdistrict" class="form-control">
              </select>
            </div>
          </div>
        </fieldset>
           </div>       
        <div class="tab-pane" id="tab-authentication">
        <legend>{{ text_license_information }}</legend>            
            <div class="alert alert-info"><i class="fa fa-info-circle"></i> {{ text_license_content }}</div>            
            <div class="form-group required">
                <label class="col-sm-3" for="module_bundle_rajaongkirapi">
                    {{ entry_select_used_api }} 
                 </label>
                <div class="col-sm-9">
                <select name="module_bundle_apitype" class="form-control">
                    {% if module_bundle_apitype == "ownapi" %}
                        <option value="ownapi" selected="selected">{{ text_use_your_api }}</option>
                        <option value="hpwdapi">{{ text_use_hpwd_api }}</option> 
                     {% else %}
                        <option value="ownapi">{{ text_use_your_api }}</option>
                        <option value="hpwdapi" selected="selected">{{ text_use_hpwd_api }}</option> 
                    {% endif %}
                    </select>
                </div>
              </div>
            
            <div class="alert alert-info"><i class="fa fa-info-circle"></i> {{ text_api_notification }}</div>
            
       <div id="own-api">     
        <legend>{{ text_use_your_api }}</legend>            
             <div class="form-group required">
                <label class="col-sm-3" for="module_bundle_rajaongkirapi">
                    {{ entry_rajaongkirapi }} 
                 <h6>{{ help_rajaongkirapi }}</h6>
                 </label>
                <div class="col-sm-9">
                  <input type="text" name="module_bundle_rajaongkirapi" value="{{ module_bundle_rajaongkirapi }}" id="module_bundle_rajaongkirapi" size="10" class="form-control" />
          
                </div>
              </div>
            
              <div class="pull-right">
                  <button type="button" id="button-apply-api" data-dismiss="alert" class="btn btn-success"><i class="fa fa-save"></i> {{ button_apply_api }}</button>
                  <button type="button" id="button-clear-api" data-dismiss="alert" class="btn btn-default"><i class="fa fa-close"></i> {{ button_clear }}</button>
                </div>  
            <div class="clearfix"></div>
         </div>
            
        <div id="hpwd-api">
        <legend id="validate-order">{{ text_use_hpwd_api }}</legend>
              <div class="form-group required">
                <label class="col-sm-3" for="module_bundle_username">
                    {{ entry_username }}
                    <h6>{{ entry_username_help }}</h6>
                    
                  </label>
                <div class="col-sm-9">
                  <input type="text" name="module_bundle_username" value="{{ module_bundle_username }}" id="module_bundle_username" class="form-control" />
                </div>
              </div>
        
        <div class="form-group required">
                <label class="col-sm-3" for="module_bundle_order_id">
                    {{ entry_order_id }}                    
                  </label>
                <div class="col-sm-9">
                  <input type="text" name="module_bundle_order_id" value="{{ module_bundle_order_id }}" id="module_bundle_order_id" class="form-control" />
                </div>
              </div>
                    
            <div class="pull-right">
                  <button type="button" id="button-validate-order" data-dismiss="alert" class="btn btn-success"><i class="fa fa-save"></i> {{ button_validate_order }}</button>
                </div>
            </div>
           </div>
           
               
        <div class="tab-pane" id="tab-sortorder">
                 <label class="col-sm-3" for="input-sort-order">
                {{ entry_sort_order }}
                    <h6>{{ help_sort_order }}</h6>
                </label>
            <div class="col-sm-9">
                <section>
                    <ul class="list-group list-group-sortable">
                    {% set nomer = 1 %}
                        {% for key,sort_order in sort_orders %}
                        <li class="list-group-item" data-value="{{ key }}"> {{ nomer }} . {{sort_order.name }}</li>
                                {% set nomer = nomer + 1 %}
                        {% endfor %}
                    </ul>
                </section>
                
    
                <div id="sortorders">
                    {% for key,sort_order in sort_orders %}
                        <input type="hidden" name="shipping_{{ key }}_sort_order" value="{{ sort_order.value }}" />
                        {% endfor %}
                    </div> 
                

                    <div class="buttons clearfix">
                        <div class="pull-right"><a id="button-save-sortorder" class="btn btn-success">{{ button_save_sortorder }}</a></div>
                    </div> 
                </div>
           </div>
        <div class="tab-pane" id="tab-shipping">
             <div class="col-sm-3">
                 <ul class="nav nav-pills nav-stacked" id="address">
                     <li class="active"><a href="#tab-courier" data-toggle="tab">{{ text_shippings }}</a></li>
                    {% set courier_row = 1 %}
                   {% for shipping,courier in couriers %}
                    <li><a href="#tab-courier{{ courier_row }}" data-toggle="tab">{{ courier_row }}. {{ shipping }}</a></li>
                        {% set courier_row = courier_row + 1 %}
                    {% endfor %}
                 </ul>
                </div>
            <div class="col-sm-9">
                  <div class="tab-content" id="shipping_list">
                    {% set courier_row = 1 %}
                    {% for shipping,courier in couriers %}
                    <div class="tab-pane" id="tab-courier{{ courier_row }}">
                     <div class="form-group required">
                        <label class="col-sm-3" for="input-shipping">
                            {{ entry_preferred_shipping }}
<!--                            <h6>{{ help_preferred_shipping }}</h6>-->
                            </label>
                        <div class="col-sm-9">
                        <span class="shipping-image"><img src="view/image/shipping/{{ shipping }}.png"/></span>
                        <div class="shipping-services">
                        {% for code,name in  courier%}  
                            {% if code in module_bundle_preferred_shipping %}
                            <span><input checked="checked" name="module_bundle_preferred_shipping[]" value="{{ code }}" type="checkbox" data-control="checkbox" data-off-label="{{ text_no }}" data-on-label="{{ text_yes }}" > {{ name }}</span>
                            {% else %}
                             <span><input name="module_bundle_preferred_shipping[]" value="{{ code }}" type="checkbox"  data-control="checkbox" data-off-label="{{ text_no }}" data-on-label="{{ text_yes }}" > {{ name }}</span>
                            {% endif %}
                        {% endfor %}
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-3" for="module_bundle_total_shipping">
                            {{ entry_total_shipping }}
                            <h6>{{ help_total_shipping }}</h6>
                        </label>        
                        <div class="col-sm-9">   
                            <input type="text" class="form-control" name="module_bundle_total_shipping_{{ shipping }}" value="{{ _context['module_bundle_total_shipping_'~shipping] }}" />
                        </div>
                    </div> 

                    <div class="form-group">
                        <label class="col-sm-3" for="module_bundle_tax_class_id">{{ entry_tax_class }}</label>        
                            <div class="col-sm-9">       
             <select name="module_bundle_tax_class_id_{{ shipping }}" id="module_bundle_tax_class_id_{{ shipping }}" class="form-control">
                              <option value="0">{{ text_none }}</option>
                               {% for tax_class in tax_classes %}
                              {% if tax_class.tax_class_id == _context['module_bundle_tax_class_id_'~shipping] %}
                              <option value="{{ tax_class.tax_class_id }}" selected="selected">{{ tax_class.title }}</option>
                              {% else %}
                              <option value="{{ tax_class.tax_class_id }}">{{ tax_class.title }}</option>
                              {% endif %}
                              {% endfor %}
                            </select>
                            </div>
                    </div>
                     <div class="form-group">
                        <label class="col-sm-3" for="module_bundle_geo_zone_id">{{ entry_geo_zone }}</label>        
                            <div class="col-sm-9">            
            <select name="module_bundle_geo_zone_id_{{ shipping }}" id="module_bundle_geo_zone_id_{{ shipping }}" class="form-control">
                              <option value="0">{{ text_all_zones }}</option>
                               {% for geo_zone in geo_zones %}
                              {% if geo_zone.geo_zone_id == _context['module_bundle_geo_zone_id_'~shipping] %}
                              <option value="{{ geo_zone.geo_zone_id }}" selected="selected">{{ geo_zone.name }}</option>
                              {% else %}
                              <option value="{{ geo_zone.geo_zone_id }}">{{ geo_zone.name }}</option>
                              {% endif %}
                              {% endfor %}
                            </select></div>
                       </div>
                    </div>
                      
                      {% set courier_row = courier_row + 1 %} 
                    {% endfor %}
              </div>
            </div>
            
              <div class="buttons clearfix">
                        <div class="pull-right"><a id="button-save-shipping" class="btn btn-info">{{ button_save_shipping }}</a></div>
                    </div>
            
        </div>
           
           <div class="tab-pane" id="tab-advance">
            <div class="form-group">
                <label class="col-sm-3">
                    {{ entry_uninstall_table }}
                    <h6>{{ help_uninstall_table }}</h6>
                </label>        
                <div class="col-sm-9">            
                    <span onclick="confirm('{{ text_confirm }}') ? location.href='{{ uninstall }}' : false;" class="btn btn-danger">{{ button_uninstall_table }}</span>
                </div>
            </div> 
            {% if module_bundle_apitype == "hpwdapi" %}
               <div class="form-group">
                <label class="col-sm-3">
                    {{ text_eligible_api_usage }}
                    <h6>{{ help_eligible_api_usage }}</h6>
                </label>        
                <div class="col-sm-9">   
                    <h3 class="label label-success">{{ eligible_status }}</h3>
                    <h3 class="label label-info">{{ eligible_date }}</h3>
                </div>
            </div> 
               {% endif %}
           </div>
           
            <div class="tab-pane" id="tab-help">
                <legend>{{ text_support }}</legend>
            <div class="alert alert-info"><i class="fa fa-info-circle"></i> {{ text_support_content }}</div>                            
                <div>
                    <img width="150" src="view/image/logohpwd.png" />
                      <p>
                        <a target="_blank" href="http://hpwebdesign.id">http://hpwebdesign.id</a>  <br />
                        <a target="_blank" href="mailto:support@hpwebdesign.id">support@hpwebdesign.id</a>  
                      </p>
                  </div>
           </div>
           
          </div>
      </div>
          </form> 
    
    </div>
  </div>
</div>

<script src="view/javascript/jquery/jquery-ui/jquery-ui.js"></script>
<script type="text/javascript"><!--  
    
var module_bundle_city_id = '{{ module_bundle_city_id }}';
    
$('#button-save-sortorder').on('click', function() {
    $.ajax({
		url: 'index.php?route=extension/module/bundle_setting/sortorder&user_token={{ user_token }}',
        data: $('#sortorders input[type=\'hidden\']'),
        type: 'post',
		dataType: 'json',
		beforeSend: function() {
			$('#button-save-sortorder').attr("disabled",true);
		},
		complete: function() {
			$('#button-save-sortorder').attr("disabled",false);
		},
		success: function(json) {
          $('.alert').remove();
            
             if(json['success'])    {
                $('#tab-sortorder').prepend('<div class="clearfix alert alert-success"><i class="fa fa-exclamation-circle"></i> ' + json['success'] + ' <button type="button" class="close" data-dismiss="alert">&times;</button></div>');
            }  
            
            if(json['error'])    {
                $('#tab-sortorder').prepend('<div class="clearfix alert alert-danger"><i class="fa fa-exclamation-circle"></i> ' + json['error'] + ' <button type="button" class="close" data-dismiss="alert">&times;</button></div>');
            }  
            
            $('html, body').animate({ scrollTop: 0 }, 'slow');
                               
            $('.alert-danger, .alert-info').fadeIn('slow');
            $('.alert-danger, .alert-info').delay(2000).fadeOut("slow");
		},
		error: function(xhr, ajaxOptions, thrownError) {
			alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
		}
	});
});
    
$('#button-save-shipping').on('click', function() {
    $.ajax({
		url: 'index.php?route=extension/module/bundle_setting/shipping&user_token={{ user_token }}',
        data: $('.shipping-services input[type=\'checkbox\']:checked, .shipping-services input[type=text], .shipping-services select'),
        type: 'post',
		dataType: 'json',
		beforeSend: function() {
			$('#button-save-shipping').attr("disabled",true);
		},
		complete: function() {
			$('#button-save-shipping').attr("disabled",false);
		},
		success: function(json) {
          $('.alert').remove();
                        
             if(json['success'])  {
                $('#tab-shipping').prepend('<div class="clearfix alert alert-success"><i class="fa fa-exclamation-circle"></i> ' + json['success'] + ' <button type="button" class="close" data-dismiss="alert">&times;</button></div>');
            }  
            
            if(json['error']) {
                 $('#tab-shipping').prepend('<div class="clearfix alert alert-danger"><i class="fa fa-exclamation-circle"></i> ' + json['error'] + ' <button type="button" class="close" data-dismiss="alert">&times;</button></div>');
            }
                                    
            $('html, body').animate({ scrollTop: 0 }, 'slow');
                               
            $('.alert-danger, .alert-info').fadeIn('slow');
            $('.alert-danger, .alert-info').delay(2000).fadeOut("slow");
		},
		error: function(xhr, ajaxOptions, thrownError) {
			alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
		}
	});
});
    
$('select[name=\'module_bundle_province_id\']').on('change', function() {
    $.ajax({
		url: 'index.php?route=localisation/country/country&user_token={{ user_token }}&country_id=' + this.value,
		dataType: 'json',
		beforeSend: function() {
			$('select[name=\'module_bundle_province_id\']').prop('disabled', true);
		},
		complete: function() {
			$('select[name=\'module_bundle_province_id\']').prop('disabled', false);
		},
		success: function(json) {
			html = '<option value="">{{ text_select }}</option>';

			if (json['zone'] && json['zone'] != '') {
				for (i = 0; i < json['zone'].length; i++) {
          			html += '<option value="' + json['zone'][i]['zone_id'] + '"';

					if (json['zone'][i]['zone_id'] == '{{ module_bundle_city_id }}') {
            			html += ' selected="selected"';
					}

					var type = json['zone'][i]['type'] == 'Kota' ? 'Kota' : 'Kab.';
                    html += '>' + type + ' ' + json['zone'][i]['name'] + '</option>';
                    
				}
			} else {
				html += '<option value="0" selected="selected">{{ text_none }}</option>';
			}

			$('select[name=\'module_bundle_city_id\']').html(html);
			$('select[name=\'module_bundle_city_id\']').trigger('change');
			
			$('#button-save').prop('disabled', false);
		},
		error: function(xhr, ajaxOptions, thrownError) {
			alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
		}
	});
});
    
$('select[name=\'module_bundle_city_id\']').on('change', function() {
	$.ajax({
        url: 'index.php?route=localisation/zone/zone&user_token={{ user_token }}&zone_id=' + this.value,
		dataType: 'json',
		beforeSend: function() {
			$('select[name=\'module_bundle_city_id\']').prop('disabled', true);
		},
		complete: function() {
			$('select[name=\'module_bundle_city_id\']').prop('disabled', false);
		},
		success: function(json) {    
            html = '<option value="">{{ text_select }}</option>';

                if (json['subdistrict'] && json['subdistrict'] != '') {
                    for (i = 0; i < json['subdistrict'].length; i++) {
                        html += '<option value="' + json['subdistrict'][i]['sub_district_id'] + '"';
                    if (json['subdistrict'][i]['sub_district_id'] == '{{ module_bundle_sub_district_id }}') {
            			html += ' selected="selected"';
					}
                        html += '>' +  json['subdistrict'][i]['name'] + '</option>';
                    }
                } else {
                    html += '<option value="0" selected="selected">{{ text_none }}</option>';
                }

			 $('select[name=\'module_bundle_sub_district_id\']').html(html);
		},
		error: function(xhr, ajaxOptions, thrownError) {
			// alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
		}
	});
});    

$('select[name=\'module_bundle_province_id\']').trigger('change');
//--></script>

<script type="text/javascript"><!--   
$('#button-validate-order').on('click', function() {
    var username = $('input[name=\'module_bundle_username\']').val();
    var order_id = $('input[name=\'module_bundle_order_id\']').val();
    
    $.ajax({
		url: 'index.php?route=extension/module/bundle_setting/validateOrder&user_token={{ user_token }}&username=' + username + '&order_id=' + order_id,
		dataType: 'json',
		beforeSend: function() {
			$('#button-validate-order').after(' <i class="fa fa-circle-o-notch fa-spin"></i>');
		},
		complete: function() {
			$('.fa-spin').remove();
		},
		success: function(json) {
        $('.alert').remove();

            if(json['error']) {
               $('#hpwd-api legend').after('<div class="clearfix alert alert-danger"><i class="fa fa-exclamation-circle"></i> ' + json['error'] + ' <button type="button" class="close" data-dismiss="alert">&times;</button></div>');
                    }
            
             if(json['success']) {
                $('#hpwd-api legend').after('<div class="clearfix alert alert-info"><i class="fa fa-exclamation-circle"></i> ' + json['success'] + ' <button type="button" class="close" data-dismiss="alert">&times;</button></div>');
                }  
                
            $('.alert-danger, .alert-info').fadeIn('slow');
            $('.alert-danger, .alert-info').delay(2000).fadeOut("slow");
                
		},
		error: function(xhr, ajaxOptions, thrownError) {
			alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
		}
	});
});
    
$('#button-apply-api').on('click', function() {
    var apikey = $('input[name=\'module_bundle_rajaongkirapi\']').val();
    
    $.ajax({
		url: 'index.php?route=extension/module/bundle_setting/applyApi&user_token={{ user_token }}&apikey=' + apikey,
		dataType: 'json',
		beforeSend: function() {
			$('#button-apply-api').after(' <i class="fa fa-circle-o-notch fa-spin"></i>');
		},
		complete: function() {
			$('.fa-spin').remove();
		},
		success: function(json) {
        $('.alert').remove();

            if(json['error']) {
               $('#own-api legend').after('<div class="clearfix alert alert-danger"><i class="fa fa-exclamation-circle"></i> ' + json['error'] + ' <button type="button" class="close" data-dismiss="alert">&times;</button></div>');
                }
            
             if(json['success']) {
                $('#own-api legend').after('<div class="clearfix alert alert-info"><i class="fa fa-exclamation-circle"></i> ' + json['success'] + ' <button type="button" class="close" data-dismiss="alert">&times;</button></div>');

                $('select[name=\'module_bundle_province_id\']').trigger('change');
            }
    
            $('.alert-danger, .alert-info').fadeIn('slow');
            $('.alert-danger, .alert-info').delay(2000).fadeOut("slow");
		},
		error: function(xhr, ajaxOptions, thrownError) {
			alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
		}
	});
});
  
$('#own-api, #hpwd-api').hide();    

$('select[name=module_bundle_apitype]').on('change', function() {
    
    if($('select[name=module_bundle_apitype]').val() == 'ownapi') {
       $('#own-api').show();   
       $('#hpwd-api').hide();   
    } else {
       $('#own-api').hide();   
       $('#hpwd-api').show();   
    }
    
});
    
$('select[name=module_bundle_apitype]').trigger('change');
    
$('#button-clear-api').on('click', function() {
    var apikey = $('input[name=\'module_bundle_rajaongkirapi\']').val();
    
    if(confirm('{{ text_confirm }}')) {
    $.ajax({
		url: 'index.php?route=extension/module/bundle_setting/clearApi&user_token={{ user_token }}&apikey=' + apikey,
		dataType: 'json',
		beforeSend: function() {
			$('#button-clear-api').after(' <i class="fa fa-circle-o-notch fa-spin"></i>');
		},
		complete: function() {
			$('.fa-spin').remove();
		},
		success: function(json) {
        $('.alert').remove();

            if(json['error']) {
               $('#own-api legend').after('<div class="clearfix alert alert-danger"><i class="fa fa-exclamation-circle"></i> ' + json['error'] + ' <button type="button" class="close" data-dismiss="alert">&times;</button></div>');
                }
            
             if(json['success']) {
               $('#own-api legend').after('<div class="clearfix alert alert-info"><i class="fa fa-exclamation-circle"></i> ' + json['success'] + ' <button type="button" class="close" data-dismiss="alert">&times;</button></div>');

                $('input[name=\'module_bundle_rajaongkirapi\']').val('');
                $('select[name=\'module_bundle_province_id\']').trigger('change');
            }
    
            $('.alert-info, .alert-danger').fadeIn('slow');
            $('.alert-info, .alert-danger').delay(2000).fadeOut("slow");
		},
		error: function(xhr, ajaxOptions, thrownError) {
			alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
		  }
});
   }
});
   
// Sort Order
//$("input[name='module_bundle_preferred_shipping[]']").on('change', function() {
//    var list_items = '';
//    var sort_orders = '';
//    var i = 0;
//    var number = 1;
//    var val = 0;
//    
//    $("input[name='module_bundle_preferred_shipping[]']:checked").each(function() {
//        
//        console.log($('#sortorders > input').length);
//        
//       
//        
//        list_items += '<li data-value="'+ $(this).val() +'" class="list-group-item">' + number + '. ' + $(this).next().html() + '</li>';
//        
//        if($('input[name=\'shipping_'+ $(this).val() +'_sort_order\']').val()) {
//            val = $('input[name=\'shipping_'+ $(this).val() +'_sort_order\']').val();
//        } else {
//             val = $('#sortorders > input').length;
//        }
//        
//        sort_orders += '<input type="hidden" name="shipping_'+ $(this).val() +'_sort_order" value="'+ val +'" />';
//        i += 1;
//        number += 1;
//    });
//    
// $('ul.list-group-sortable').html(list_items);
// $('#sortorders').html(sort_orders);
//    
// $(function() {
//         $('ul.list-group-sortable').sortable();
//         $('ul.list-group-sortable').disableSelection();
//    });
//    
//});
    
$('.list-group-sortable').sortable().bind('sortupdate', function(e, ui) {
     $( "ul li.list-group-item" ).each(function(index) {
         var teks = $(this).text()
             teks = teks.split('.');
         
         $('li.list-group-item').eq(index).text(index+1 + '.' + teks[1]);
         
         $('input[name=shipping_'+ $('li.list-group-item').eq(index).attr('data-value') +'_sort_order]').val(index);
         
        });
    
});
        
	(function($){
		$(document).ready(function(){

            if($.fn.checkboxpicker){
                $('[data-control=checkbox]').checkboxpicker({ onClass: 'btn-info' });
                
                $('.shipping-services .btn-default, .shipping-services .btn-success, .shipping-services .btn-danger').addClass('btn-sm');    
             }
            
             $('.btn-group .btn').addClass('btn-sm');

            $('a[href=\'#tab-courier1\'').trigger('click');   
            });
	})(jQuery);    
//--></script>

<style type="text/css">
    #tab-shipping li {
        text-transform: uppercase;
    }
    
    .shipping-image img {
        border: 1px solid #ddd;
        border-radius: 3px;
        margin-right: 10px;
        padding: 3px 5px;
    }
    
    .shipping-services {
        margin-top: 10px;
    }
    
    .panel-body { position: relative;}
    #button-save {
        position: absolute;
        right: 10px;
        top: 9px;
    }    
    
    .shipping-services span { margin-right: 10px; display: block; padding-bottom: 10px;}
    .shipping-services span input { margin-right: 10px; }
    h6 { line-height: 1.3em; } 
    #options img {
    border: 1px solid #ddd;
    border-radius: 4px;
    padding: 5px;
height: 80px;
float: right;
    }
</style>
{{ footer }}